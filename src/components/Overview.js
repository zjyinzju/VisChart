import React, { useContext, useState, useEffect, useCallback } from 'react';
import ReactEcharts from 'echarts-for-react';
import { Slider } from 'antd';
import { store } from '../store';

function Overview() {
    const { state } = useContext(store);
    const [yAxisRange, setYAxisRange] = useState([15.5, 21]);
    const [year, setYear] = useState([1850, 2020]);
    const [option, setOption] = useState({});

    const getOption = useCallback(() => {
        const startIndex = year[0] - 1850;
        const endIndex = year[1] - 1850 + 1;
        const yearRange = Array.from({length: endIndex - startIndex }, (_, i) => i + year[0]);

        const seaSurfaceSeries = [
            {
                name: 'Global',
                data: [19.6905,19.80663,19.81661,19.78902,19.73157,19.75827,19.69466,19.57258,19.59753,19.72104,19.76313,19.63572,19.6028,19.67101,19.63139,19.78678,19.79225,19.79425,19.7839,19.7161,19.77431,19.76827,19.75546,19.70522,19.60829,19.75851,19.65399,19.97461,19.99539,19.80225,19.7966,19.84732,19.78441,19.75062,19.64507,19.65992,19.64623,19.57467,19.74608,19.83158,19.561,19.71972,19.57809,19.58312,19.55786,19.64658,19.84071,19.79593,19.56053,19.68338,19.76398,19.63601,19.5463,19.42557,19.39764,19.56479,19.61549,19.53146,19.4313,19.41329,19.41578,19.41376,19.54888,19.51671,19.66251,19.77304,19.58492,19.54067,19.58627,19.63287,19.71538,19.74019,19.65878,19.68166,19.68778,19.73372,19.85713,19.7835,19.75091,19.68,19.83162,19.8885,19.80735,19.73438,19.79239,19.78411,19.82203,19.96127,19.88251,19.89745,19.98801,20.00327,20.04635,20.04031,20.19544,20.19232,19.9221,19.85193,19.86675,19.89051,19.87545,19.97988,20.06937,20.07613,19.88944,19.81302,19.79976,20.00168,20.02431,19.97027,19.92517,19.97268,19.91776,19.96474,19.75964,19.79685,19.90737,19.84914,19.84771,20.01328,19.90576,19.74442,19.97681,20.01075,19.85284,19.84552,19.86765,20.07836,20.02786,20.14543,20.14203,20.11512,20.09825,20.1946,20.06038,20.04476,20.0739,20.23264,20.20845,20.16803,20.29425,20.27296,20.17579,20.20568,20.24524,20.30009,20.23714,20.42091,20.51006,20.27619,20.28053,20.39199,20.43434,20.45946,20.4376,20.44789,20.42388,20.35835,20.33213,20.4801,20.48557,20.37851,20.44911,20.47344,20.57639,20.70045,20.71945,20.64483,20.61641,20.71702,20.70998].slice(startIndex, endIndex),
                type: 'line',
            },
            {
                name: 'Northern Hemisphere',
                type: 'line',
                data: [19.75457,19.87403,19.95876,19.92901,19.90867,19.92722,19.7269,19.69193,19.65059,19.77174,19.81515,19.80385,19.50535,19.7057,19.76734,19.93385,19.89215,19.93464,20.04032,19.91137,19.97819,19.81926,19.80808,19.74495,19.70585,19.7868,19.76138,20.1577,20.1477,19.84496,19.83176,19.85561,19.75597,19.7226,19.64315,19.7508,19.71065,19.66256,19.89389,19.91836,19.5984,19.81366,19.59169,19.55468,19.53359,19.71199,19.91269,19.90423,19.70799,19.76156,19.92181,19.75151,19.6082,19.50736,19.42627,19.59956,19.66369,19.55442,19.47583,19.47065,19.4555,19.53298,19.57469,19.46531,19.66076,19.8103,19.57871,19.5394,19.5456,19.61813,19.67652,19.77327,19.70418,19.70164,19.75025,19.78021,19.95731,19.90135,19.83248,19.77148,19.94693,19.96991,19.85677,19.82632,19.82665,19.85485,19.9398,20.07546,19.93992,19.90721,19.9726,20.0216,20.13673,20.09311,20.22701,20.24019,20.04629,19.92738,19.96951,19.94887,19.96825,20.13304,20.13137,20.13419,19.97587,19.91075,19.84073,20.05476,20.13829,20.04891,20.00403,20.01988,19.96836,20.05411,19.86424,19.84265,20.03296,19.97214,19.93734,20.00904,19.91555,19.71859,19.88679,19.94514,19.80813,19.80596,19.81547,20.02875,20.02351,20.11557,20.11814,20.11871,20.09709,20.13134,19.98965,19.94708,20.02305,20.18199,20.18924,20.16616,20.3433,20.29117,20.16649,20.17764,20.30743,20.37636,20.24322,20.46561,20.54005,20.30584,20.32846,20.43002,20.45919,20.53578,20.54965,20.55676,20.51703,20.46049,20.43452,20.51944,20.55668,20.41673,20.52636,20.55485,20.71281,20.86102,20.85601,20.78167,20.73886,20.85743,20.92974].slice(startIndex, endIndex)
            },
            {
                name: 'Southern Hemisphere',
                type: 'line',
                data: [19.61518,19.72508,19.67471,19.655,19.57769,19.61548,19.66917,19.48094,19.56032,19.6821,19.72661,19.5423,19.6486,19.6545,19.57011,19.72447,19.73649,19.720579999999998,19.68713,19.59816,19.67036,19.74158,19.73153,19.68224,19.56035,19.73819,19.57868,19.85284,19.88254,19.77563,19.77467,19.83969,19.80577,19.77291,19.65027,19.58513,19.59245,19.50352,19.63041,19.76683,19.53282,19.63429,19.57116,19.60456,19.57833,19.59722,19.77721,19.70794,19.43118,19.61735,19.63216,19.53362,19.48979,19.35668,19.37148,19.53042,19.56922,19.50793,19.38375,19.35488,19.37726,19.29529,19.52525,19.56931,19.66769,19.71487,19.59128,19.54812,19.67164,19.66304,19.77984,19.69662,19.60444,19.65822,19.61321,19.67737,19.74111,19.65646,19.65861,19.5731,19.68853,19.79004,19.74656,19.62335,19.74982,19.70427,19.69847,19.8363,19.82031,19.86565,20.01625,19.97293,19.91781,19.96412,20.13325,20.08786,19.769,19.76307,19.75317,19.82146,19.77376,19.79628,19.99448,20.0028,19.78354,19.69206,19.7589,19.94096,19.8933,19.88281,19.83791,19.92244,19.8632,19.86785,19.65133,19.75011,19.77272,19.71297,19.74962,20.0193,19.89433,19.77321,20.06555,20.07664,19.90224,19.88934,19.92369,20.12641,20.0333,20.17305,20.16289,20.1116,20.10279,20.25301,20.12665,20.13211,20.11983,20.27675,20.22566,20.16678,20.24439,20.25616,20.18537,20.23383,20.18262,20.22653,20.22948,20.37814,20.47908,20.24633,20.23099,20.35358,20.40908,20.38488,20.33035,20.34459,20.33756,20.26591,20.24081,20.4418,20.42176,20.3414,20.37521,20.38887,20.44205,20.55256,20.59633,20.52084,20.50549,20.58543,20.50689].slice(startIndex, endIndex)
            },
            {
                name: 'Tropics',
                type: 'line',
                data: [19.71334,19.80126,19.84297,19.88156,19.78751,19.77366,19.68343,19.50247,19.63287,19.7852,19.69218,19.59546,19.62298,19.57544,19.4817,19.88974,19.85704,19.8877,19.87061,19.79347,19.72745,19.78102,19.67727,19.65094,19.44414,19.70913,19.63263,20.09526,20.24758,19.72049,19.74223,19.94485,19.68894,19.6166,19.57929,19.69485,19.66932,19.52755,19.93935,19.95882,19.39678,19.73389,19.43648,19.44475,19.43457,19.74525,20.0099,20.03483,19.51595,19.70786,19.95664,19.75642,19.66065,19.51521,19.31922,19.65937,19.63385,19.53018,19.38395,19.4374,19.45272,19.41881,19.68732,19.60509,19.74605,19.88351,19.50373,19.43019,19.5763,19.69968,19.6856,19.72327,19.62513,19.7012,19.72307,19.75386,20.04348,19.85458,19.8014,19.71251,19.91525,20.07969,19.82546,19.73669,19.73588,19.79567,19.86643,20.0003,19.77093,19.80985,20.14966,20.18326,19.95721,19.87614,20.12369,20.14594,19.90547,19.88714,19.847,19.78222,19.69028,19.95446,20.01694,20.09621,19.76929,19.62209,19.6369,20.02676,20.09415,19.96342,19.8974,19.86324,19.82205,20.03342,19.75685,19.85219,19.98356,19.71544,19.80716,20.16513,19.88166,19.57579,20.06341,20.02229,19.69688,19.63954,19.80304,20.08217,20.00613,20.15591,20.18832,20.09292,20.22216,20.36222,20.06755,19.95488,20.11925,20.47569,20.26985,20.07459,20.28776,20.3265,20.25408,20.26801,20.28225,20.38617,20.26192,20.50692,20.64461,20.12757,20.17346,20.33835,20.48184,20.52864,20.4374,20.45416,20.43658,20.32347,20.23972,20.54985,20.52412,20.22253,20.37905,20.42168,20.54282,20.80844,20.83837,20.64178,20.51342,20.72706,20.72565].slice(startIndex, endIndex)
            }
        ];

        const landSeries = [
            {
                name: 'Land',
                data: [16.86026,16.76113,15.83136,16.03067,16.12429,16.13863,16.88511,16.74469,17.08138,17.68698,17.11155,17.19958,16.01359,16.42633,16.72861,16.57747,16.36495,16.44777,16.93685,17.02108,16.60671,16.14348,16.69827,17.25198,17.34341,17.37470,17.75928,18.00654,18.34222,17.36974,17.73537,17.73636,17.81381,17.98762,17.77304,17.67692,17.93526,17.81422,17.71716,18.13900,18.06021,18.19211,18.21535,18.13538,18.24569,18.25066,18.34111,18.47770,18.37606,18.44216,18.51454,18.49119,18.32801,18.43477,18.21108,18.39951,18.48142,18.13716,18.29103,18.34413,18.38008,18.40820,18.46474,18.49149,18.66060,18.71124,18.55188,18.24255,18.39374,18.53186,18.53230,18.60505,18.50415,18.56542,18.62186,18.58891,18.86793,18.73918,18.73846,18.48582,18.84251,18.75540,18.74608,18.55832,18.81882,18.72231,18.81062,18.95795,18.87345,18.81153,18.70296,18.88145,18.76261,18.81704,18.85743,18.80657,18.92441,19.04099,18.78403,18.74807,18.59972,18.77512,18.80569,18.85564,18.58032,18.65729,18.28759,18.75962,18.94217,18.82521,18.88701,18.92357,18.69385,18.67525,18.58127,18.51754,18.86629,18.63419,18.60582,18.77153,18.79412,18.58821,18.66561,18.87329,18.63145,18.74666,18.48220,18.92226,18.72952,18.90954,18.85332,18.91614,18.85217,19.09404,18.76496,18.69913,18.80115,19.05104,19.11168,19.05677,19.31769,19.01136,18.97201,18.93080,19.25170,19.26707,18.95837,19.25035,19.59678,19.39210,19.34920,19.42530,19.56552,19.52509,19.42209,19.49959,19.53913,19.61039,19.42396,19.54639,19.62981,19.45604,19.46874,19.56153,19.76041,19.89588,19.90459,19.78565,19.85100,19.94335,19.95471].slice(startIndex, endIndex),
                type: 'line',
            }
        ];

        return {
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: state.category === 'seaSurface' 
                    ? ['Global', 'Northern Hemisphere', 'Southern Hemisphere', 'Tropics']
                    : ['land']
            },
            xAxis: {
                type: 'category',
                data: yearRange,
            },
            yAxis: {
                type: 'value',
                name: 'temperature/â„ƒ',
                min: yAxisRange[0],
                max: yAxisRange[1],
            },
            series: state.category === 'seaSurface' ? seaSurfaceSeries : landSeries
        };
    }, [year, yAxisRange, state.category]);

    useEffect(() => {
        setOption(getOption());
    }, [year, yAxisRange, state.category, getOption]);

    return (
        <div>
            <center>
            <h2>Average temperature</h2>
            <br/>
            <Slider
                range
                step={1}
                defaultValue={[1850, 2020]}
                min={1850}
                max={2020}
                onChange={setYear}
                marks={{ 1850: '1850', 2020: '2020' }}
            />
            <Slider
                range
                step={0.1}
                defaultValue={[15.5, 21]}
                min={15.5}
                max={21}
                onChange={setYAxisRange}
                marks={{ 15.5: '15.5', 21: '21' }}
            />
            <ReactEcharts option={option} />
             </center>
        </div>
    );
}

export default Overview;